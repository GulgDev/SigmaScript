(()=>{"use strict";var __webpack_modules__={111:(e,n,t)=>{var r;t.d(n,{b:()=>M}),function(e){e.isWhitespace=function(e){return" "===e||"\n"===e||"\r"===e},e.isDigit=function(e){if(!e)return!1;const n=e.charCodeAt(0);return n>=48&&n<=57},e.isLetter=function(e){if(!e)return!1;const n=e.toLowerCase().charCodeAt(0);return n>=97&&n<=122}}(r||(r={}));class s{constructor(e){this.buffer=e,this._offset=0,this.line=0,this.column=0}get location(){return{offset:this._offset,line:this.line,column:this.column}}set location(e){this._offset=e.offset,this.line=e.line,this.column=e.column}get offset(){return this._offset}peekch(){return this.buffer[this._offset]}consume(){"\n"===this.peekch()?(++this.line,this.column=0):++this.column,++this._offset}}class o{constructor(e={},n){this.elements=e,this.last=n}with(e,n){const t=Object.assign({},this.elements);return t[e]=t[e]?[...t[e],n]:[n],new o(t,n)}has(e,n){var t;return null===(t=this.elements[e])||void 0===t?void 0:t.includes(n)}}class c{}class a extends c{constructor(e){super(),this.ch=e}match(e){const n=e.location;if(e.peekch()===this.ch)return e.consume(),{start:n,end:e.location}}}class i extends c{constructor(e,n){super(),this.a=e,this.b=n}match(e,n,t=1,r=new o,s={}){const c=e.location,a=!(this.a instanceof _&&r.has(c.offset,this.a.name))&&this.a.match(e,n,t,r,s),i=e.location;e.location=c;const u=!(this.b instanceof _&&r.has(c.offset,this.b.name))&&this.b.match(e,n,t,r,s),l=e.location;let f=!a&&u||!u&&a;if(a&&u&&(f=i.offset>l.offset?a:u),f===a&&(e.location=i),f)return{start:c,end:e.location,children:[f]}}}class u extends c{match(e){const n=e.location;for(;r.isWhitespace(e.peekch());)e.consume();return{start:n,end:e.location}}}class l extends c{match(e){const n=e.location;if(e.peekch())return e.consume(),{start:n,end:e.location}}}class f extends c{match(e){const n=e.location;if(r.isDigit(e.peekch()))return e.consume(),{start:n,end:e.location}}}class d extends c{constructor(e){super(),this.pattern=e}match(e,n,t=1,r=new o,s={}){const c=e.location,a=this.pattern.match(e,n,t,r,s);return a||(e.location=c),{start:c,end:e.location,children:a?[a]:[]}}}class p extends c{constructor(e){super(),this.pattern=e}match(e,n,t=1,r=new o,s={}){const c=e.location;let a=this.pattern.match(e,n,t,r,s);const i=[a];if(!a)return;let u=e.location;for(;(a=this.pattern.match(e,n,t,r,s))&&u.offset!==e.offset;)i.push(a),u=e.location;return e.location=u,{start:c,end:e.location,children:i}}}class h extends c{constructor(e,n){super(),this.group=e,this.disallow=n}match(e){const n=e.location,t=e.peekch();if(!t)return;const r=t.charCodeAt(0);e.consume();for(const s of this.group)if(Array.isArray(s)&&r>=s[0].charCodeAt(0)&&r<=s[1].charCodeAt(0)||t===s)return!this.disallow&&{start:n,end:e.location};return this.disallow&&{start:n,end:e.location}}}class m extends c{constructor(e){super(),this.children=e}match(e,n,t=1,r=new o,s={}){const c=e.location,a=[];for(const o of this.children){const c=o.match(e,n,t,r,s);if(!c)return;a.push(c)}return{start:c,end:e.location,children:a}}}class _ extends c{constructor(e){super(),this.name=e}match(e,n,t=1,r=new o,s={}){var c;const a=`${t},${r.last},${e.offset},${this.name}`,i=s[a];if(void 0!==i)return i&&(e.location=i.end),i;const u=e.location;r=r.with(u.offset,this.name);const l=n.get(this.name);if(!l||l.precedence&&l.precedence<t)return s[a]=null;const f=l.match(e,n,l.precedence||l.preservePrecedence?null!==(c=l.precedence)&&void 0!==c?c:t:1,r,s);return s[a]=f?{name:this.name,start:u,end:e.location,children:[f]}:null}}function b(e){return"%"===e||"|"===e||"("===e||")"===e||"+"===e||"?"===e}function w(e,n,t=!1){const s=[];let o,c=!1;for(;o=e.peekch();){if(e.consume(),"%"===o)if(o=e.peekch(),b(o))e.consume(),s.push(new a(o));else{let n="";for(;r.isLetter(o=e.peekch());)e.consume(),n+=o;"d"===n?s.push(new f):s.push(new _(n))}else if("("===o)s.push(w(e,n));else{if(")"===o)break;if("["===o){const n="^"===e.peekch();n&&e.consume();const t=[];let r=!1;for(;o=e.peekch();){e.consume();const n=t.length;if("%"===o&&"]"===e.peekch())e.consume(),t.push("]");else{if("]"===o)break;if("-"===o&&!r&&n>0&&!Array.isArray(t.at(-1))){r=!0;continue}t.push(o)}if(r){r=!1;const e=t.pop();t.push([t.pop(),e])}}s.push(new h(t,n))}else if("."===o)s.push(new l);else if(" "===o)s.push(new u);else{if("|"===o&&s.length>0&&!c){c=!0;continue}"?"===o&&s.length>0?s.push(new d(s.pop())):"+"===o&&s.length>0?s.push(new p(s.pop())):s.push(new a(o))}}c&&(s.push(new i(s.pop(),s.pop())),c=!1)}const v=1===s.length?s[0]:new m(s);return v.precedence=n,v.preservePrecedence=t,v}function v(e,n,t){return w(new s(e),n,t)}class k{constructor(e,n,t,r){this.name=e,this.start=n,this.end=t,this.value=r,this.children=[]}get first(){return this.children[0]}get last(){return this.children.at(-1)}*[Symbol.iterator](){for(const e of this.children)yield e}addChild(e){this.children.push(e)}get(e){return this.children[e]}findChild(e){return this.children.find((n=>n.name===e))}find(e){const n=this.findChild(e);if(n)return n;for(const n of this.children){const t=n.find(e);if(t)return t}}}class x{constructor(e){this.patterns=new Map;for(const[n,t]of Object.entries(e))"string"==typeof t?this.patterns.set(n,v(t)):this.patterns.set(n,v(t.pattern,t.precedence,t.preservePrecedence))}parse(e){const n=this.patterns.get("root").match(new s(e),this.patterns);if(!n)return;const t=new k("root",n.start,n.end,e.slice(n.start.offset,n.end.offset));return function n(t,r){if(t.name){const n=new k(t.name,t.start,t.end,e.slice(t.start.offset,t.end.offset));r.addChild(n),r=n}if(t.children)for(const e of t.children)n(e,r)}(n,t),t}}var g=t(152);let N=-1;const j={};function y(e){const n="#dom:"+ ++N;return j[n]=e,n}function I(e){return j[e]}const O=new g.j({dom_head:y(document.head),dom_body:y(document.body)},{dom_title:([e])=>(document.title=e,"unknown"),dom_create:([e])=>y(document.createElement(e)),dom_find([e]){const n=document.querySelector(e);return n?y(n):"unknown"},dom_append([e,n]){var t;return null===(t=I(e))||void 0===t||t.appendChild(I(n)),"unknown"},dom_remove:([e])=>(I(e).remove(),"unknown"),dom_add_class([e,n]){const t=I(e);return t instanceof HTMLElement&&t.classList.add(n),"unknown"},dom_remove_class([e,n]){const t=I(e);return t instanceof HTMLElement&&t.classList.remove(n),"unknown"},dom_toggle_class([e,n]){const t=I(e);return t instanceof HTMLElement&&t.classList.toggle(n),"unknown"},dom_set_text([e,n]){const t=I(e);return t instanceof HTMLElement&&(t.innerText=n),"unknown"},dom_set_html([e,n]){const t=I(e);return t instanceof HTMLElement&&(t.innerHTML=n),"unknown"},dom_set_attr([e,n,t]){var r;return null===(r=I(e))||void 0===r||r.setAttribute(n,t),"unknown"},dom_get_attr([e,n]){var t;return null===(t=I(e))||void 0===t?void 0:t.getAttribute(n)},dom_css([e,n,t]){const r=I(e);return r instanceof HTMLElement&&r.style.setProperty(n,t),"unknown"}});let S=-1;const E={},L=new g.j({},{fn([e],{functions:n}){const t="#fn:"+ ++S;return E[t]=n[e],t},call([e,...n],t){var r,s;return null!==(s=null===(r=E[e])||void 0===r?void 0:r.call(E,n,t))&&void 0!==s?s:void 0}});var A=t(416);let $=-1;const C={},q=new g.j({},{ref([e]){const n="#ref:"+ ++$;return C[n]=null!=e?e:"unknown",n},ref_set:([e,n])=>(C[e]=n,"unknown"),ref_get([e]){var n;return null!==(n=C[e])&&void 0!==n?n:"unknown"}});var M;!function(e){const n=new x({number:"%d+",name:"[a-zA-Z_][a-zA-Z0-9_]+?",string:'"([^"]|(\\\\)|(\\"))+?"',bool:"(true)|(false)",add:{pattern:"%expr %+ %expr",precedence:5},sub:{pattern:"%expr - %expr",precedence:5},mul:{pattern:"%expr * %expr",precedence:6},div:{pattern:"%expr / %expr",precedence:6},concat:{pattern:"%expr @ %expr",precedence:1},eq:{pattern:"%expr = %expr",precedence:4},lt:{pattern:"%expr < %expr",precedence:4},gt:{pattern:"%expr > %expr",precedence:4},le:{pattern:"%expr <= %expr",precedence:4},ge:{pattern:"%expr >= %expr",precedence:4},or:{pattern:"%expr %| %expr",precedence:2},and:{pattern:"%expr & %expr",precedence:3},not:"! %expr",arglist:"(%expr( , %expr)+?)?",call:"%name %( %arglist %)",parenthesisexpr:"%( %expr %)",expr:{pattern:"%parenthesisexpr|%number|%string|%bool|%name|%add|%sub|%mul|%div|%concat|%eq|%lt|%gt|%le|%ge|%or|%and|%not|%call",preservePrecedence:!0},assign:"%name = %expr;",paramlist:"(%name( , %name)+?)?",if:"if %expr { %body } %else?",else:"else { %body }",while:"while %expr { %body }",function:"fn %name %( %paramlist %) { %body }",return:"ret %expr;",callstat:"%call;",print:"print %expr;",statement:"%assign|%if|%while|%function|%return|%callstat|%print",body:"( %statement )+?",use:"use %name;",imports:"( %use )+?",lib:"lib %name;",root:"%lib? %imports %body"}),t={};function r(e,n,t){var s;switch((e=e.first).name){case"parenthesisexpr":return r(e.first,n,t);case"name":return null!==(s=n[e.value])&&void 0!==s?s:"unknown";case"number":case"bool":return e.value;case"string":return e.value.slice(1,-1).replace(/\\\"/g,'"').replace(/\\\\/g,"\\");case"add":{const s=r(e.first,n,t),o=r(e.last,n,t),c=Number.parseInt(s)+Number.parseInt(o);return Number.isNaN(c)?"unknown":`${c}`}case"sub":{const s=r(e.first,n,t),o=r(e.last,n,t),c=Number.parseInt(s)-Number.parseInt(o);return Number.isNaN(c)?"unknown":`${c}`}case"mul":{const s=r(e.first,n,t),o=r(e.last,n,t),c=Number.parseInt(s)*Number.parseInt(o);return Number.isNaN(c)?"unknown":`${c}`}case"div":{const s=r(e.first,n,t),o=r(e.last,n,t),c=~~(Number.parseInt(s)/Number.parseInt(o));return Number.isNaN(c)?"unknown":`${c}`}case"eq":return`${r(e.first,n,t)===r(e.last,n,t)}`;case"lt":{const s=Number.parseInt(r(e.first,n,t)),o=Number.parseInt(r(e.last,n,t));return Number.isNaN(s)||Number.isNaN(o)?"unknown":`${s<o}`}case"gt":{const s=Number.parseInt(r(e.first,n,t)),o=Number.parseInt(r(e.last,n,t));return Number.isNaN(s)||Number.isNaN(o)?"unknown":`${s>o}`}case"le":{const s=Number.parseInt(r(e.first,n,t)),o=Number.parseInt(r(e.last,n,t));return Number.isNaN(s)||Number.isNaN(o)?"unknown":`${s<=o}`}case"ge":{const s=Number.parseInt(r(e.first,n,t)),o=Number.parseInt(r(e.last,n,t));return Number.isNaN(s)||Number.isNaN(o)?"unknown":`${s>=o}`}case"or":{const s=r(e.first,n,t),o=r(e.last,n,t);return`${"true"===s||"true"===o}`}case"and":{const s=r(e.first,n,t),o=r(e.last,n,t);return`${"true"===s&&"true"===o}`}case"not":return"true"===r(e.first,n,t)?"false":"true";case"concat":return r(e.first,n,t)+r(e.last,n,t);case"call":{const s=e.find("name").value,o=t[s];return o?o(Array.from(e.find("arglist")).map((e=>r(e,n,t))),{variables:n,functions:t}):"unknown"}}return"unknown"}function s(e,n,t){for(const{first:o}of e)switch(o.name){case"assign":n[o.find("name").value]=r(o.find("expr"),n,t);break;case"if":{const e=r(o.find("expr"),n,t);let c;"true"===e&&(c=s(o.find("body"),n,t));const a=o.findChild("else");if(a&&"false"===e&&(c=s(a.find("body"),n,t)),c)return c;break}case"while":{const e=o.find("expr"),c=o.find("body");for(;"true"===r(e,n,t);){const e=s(c,n,t);if(e)return e}break}case"function":{const e=o.find("body"),r=Array.from(o.find("paramlist")).map((e=>e.value));t[o.find("name").value]=o=>{var c;const a=Object.assign({},n),i=Object.assign({},t);let u=0;for(const e of r){const n=o[u];if(!n)break;a[e]=n,++u}return null!==(c=s(e,a,i))&&void 0!==c?c:"unknown"};break}case"print":console.log(r(o.find("expr"),n,t));break;case"callstat":r(o,n,t);break;case"return":return r(o.find("expr"),n,t)}}function o(e){const{variables:n,functions:r}=function(e){const n={},r={};for(const s of e){const e=s.find("name").value;if(e in t)t[e].use(n,r);else switch(e){case"js":A.T.use(n,r);break;case"dom":O.use(n,r);break;case"ref":q.use(n,r);break;case"fn":L.use(n,r)}}return{variables:n,functions:r}}(e.find("imports"));return s(e.find("body"),n,r),{variables:n,functions:r}}e.execute=o,e.load=function(e){const r=n.parse(e);if(!r||r.end.offset!==e.length)return;const s=r.findChild("lib");if(!s)return o(r);t[s.find("name").value]=new g.y(r)}}(M||(M={}))},416:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>jsLib});var _lib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(152);let objectId=-1;const objects={};function saveObject(e){const n="#js:"+ ++objectId;return objects[n]=e,n}function getObject(e){return objects[e]}function toJS(e){if(e.startsWith("#js:"))return getObject(e);if("unknown"===e)return;if("false"===e)return!1;if("true"===e)return!1;const n=Number.parseInt(e);return Number.isNaN(n)?e:n}function toSS(e){return"string"==typeof e||e instanceof String||"boolean"==typeof e||e instanceof Boolean||Number.isInteger(e)?`${e}`:null==e||Number.isNaN(e)?"unknown":saveObject(e)}const jsLib=new _lib__WEBPACK_IMPORTED_MODULE_0__.j({js_window:saveObject(window)},{js([code]){return toSS(eval(code))},js_get([e,n]){var t;const r=null===(t=getObject(e))||void 0===t?void 0:t[n];return null==r?"unknown":toSS(r)},js_set([e,n,t]){const r=getObject(e);return null!=r&&(r[n]=toJS(t)),"unknown"},js_new([e,...n]){const t=getObject(e);if(null==t)return"unknown";const r=new t(...n.map(toJS));return null==r?"unknown":toSS(r)},js_call([e,...n]){var t;const r=null===(t=getObject(e))||void 0===t?void 0:t(...n.map(toJS));return null==r?"unknown":toSS(r)},js_call_method([e,n,...t]){var r,s;const o=null===(s=null===(r=getObject(e))||void 0===r?void 0:r[n])||void 0===s?void 0:s.call(r,...t.map(toJS));return null==o?"unknown":toSS(o)}})},152:(e,n,t)=>{t.d(n,{j:()=>o,y:()=>s});var r=t(111);class s{constructor(e){this.program=e}use(e,n){const t=r.b.execute(this.program);Object.assign(e,t.variables),Object.assign(n,t.functions)}}class o{constructor(e,n){this.variables=e,this.functions=n}use(e,n){Object.assign(e,this.variables),Object.assign(n,this.functions)}}}},__webpack_module_cache__={};function __webpack_require__(e){var n=__webpack_module_cache__[e];if(void 0!==n)return n.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(e,n)=>{for(var t in n)__webpack_require__.o(n,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},__webpack_require__.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var __webpack_exports__={};(()=>{var e=__webpack_require__(111);const n={"hello-world":'print "Hello world!";',structures:'\n    print "loop from 1 to 10";\n    x = 0;\n    while x < 10 {\n    x = x + 1;\n    print x;\n    }\n    \n    if x = 10 {\n    print "x = 10";\n    } else {\n    print "x ≠ 10";\n    }\n',fibonacci:'\nfn fib(n) {\n    if n = 1 | n = 2 { ret 1; }\n    ret fib(n - 1) + fib(n - 2);\n}\n\nprint "10th Fibonacci number is " @ fib(10);\n',dom:'\nuse dom;\nuse js;\n\nprompt = js_get(js_window, "prompt");\ncolor = js_call(prompt, "Enter background color", "white");\ndom_css(dom_body, "background-color", color);\n',ref:'\nuse ref;\n\nfn inc(ref) {\n    ref_set(ref, ref_get(ref) + 1);\n}\n\nx = ref(0);\nprint "x = " @ ref_get(x);\n\ninc(x);\nprint "x = " @ ref_get(x);\n',callbacks:'\nuse fn;\n\nfn foo() {\n    print "I am foo";\n    ret 123;\n}\n\nfn bar(callback) {\n    print "I am bar";\n    print "I got " @ call(callback) @ " from callback";\n}\n\nbar(fn("foo"));'},t=document.getElementById("code"),r=document.getElementById("run"),s=document.getElementById("demo-select");r.addEventListener("click",(()=>{e.b.load(t.value)||console.error("invalid syntax")})),s.addEventListener("change",(()=>{t.value=n[s.value].trim()})),t.value=n["hello-world"].trim()})()})();